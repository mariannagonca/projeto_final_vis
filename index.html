
<main role="main" class="container">


    <div class="row">
      <h2>Parque Eólico Ventos João Câmara</h2>
    </div>
    <div class="row">
      <h6>O parque eólico Ventos João Câmara, localizado na região da cidade cearense de mesmo nome, é um dos maiores complexos eólicos do nordeste, reconhecido pelo seu alto desempenho em geração de energia. O parque opera desde o início de 2018.</h6>
      <h6>Entre os principais KPIs do setor, destacamos a geração, disponibilidade e recurso eólico.</h6>
    </div>

    <br>

    <div id='select1'>
      <div>
        <a class='reset'
           href='javascript:select1.filterAll();dc.redrawAll();'
           style='visibility: hidden;'>reset</a>
          
          buildvis = {

    let selectYear = dc.selectMenu(view.querySelector("#select1"));

    selectYear.dimension(yearDim)
    .group(prodYearGroup)
    .controlsUseVisibility(true)
    .title(function (d){ return d.key; })


  let bulletGen = dc.rowChart(view.querySelector("#bulletGen"));
  let bulletDisp = dc.rowChart(view.querySelector("#bulletDisp"));
  let bulletWind = dc.rowChart(view.querySelector("#bulletWind"));
  
    bulletGen
    .width(300)
    .height(120)
    .margins({top: 5, left: 30, right: 10, bottom: -1})
    .dimension(yearDim)
    .group(prodYearGroup)
    .colors((d) => '#7cb5ec')
    .label(function (d){
       return d3.format(".1f")(d.value/1000) + " GWh for year " + d.key;
    })
    .title(function(d){return d.value;})
    .elasticX(true)
    .xAxis().ticks(0);
    bulletGen.render();

    bulletDisp
    .width(300)
    .height(120)
    .margins({top: 5, left: 30, right: 10, bottom: -1})
    .dimension(yearDim)
    .group(dispYearGroup)
    .valueAccessor(p => p.value.avg)
    .colors((d) => '#7cb5ec')
    .label(function (d){
       return d3.format(".1f")(d.value.avg) + " % for year " + d.key;
    })
    .title(function(d){return d.value.avg;})
    .elasticX(true)
    .xAxis().ticks(0);
    bulletDisp.render();

    bulletWind
    .width(300)
    .height(120)
    .margins({top: 5, left: 30, right: 10, bottom: -1})
    .dimension(yearDim)
    .group(windYearGroup)
    .valueAccessor(p => p.value.avg)
    .colors((d) => '#7cb5ec')
    .label(function (d){
       return d3.format(".1f")(d.value.avg) + " m/s for year " + d.key;
    })
    .title(function(d){return d.value.avg;})
    .elasticX(true)
    .xAxis().ticks(0);
    bulletWind.render();

AddYAxis(bulletGen, "Geração");
AddYAxis(bulletDisp, "Disponibilidade");
AddYAxis(bulletWind, "Vel. do Vento");

  updateMarkers()

  //let yearBarChart = dc.barChart(view.querySelector("#year-chart"));
  let monthBarChart = dc.barChart(view.querySelector("#month-chart"));
  
  let heatMapChart = dc.heatMap(view.querySelector("#heatmap-chart"));
  let sunBurstChart = dc.sunburstChart(view.querySelector("#pie-chart"));


  const timeScale = d3.scaleTime()
                    .domain(d3.extent(dataset, d => d.day))
 
  const yearScale = d3.scaleLinear()
                    .range([0,width])
                    .domain([d3.min(dataset, d => d.year)- 0.5, d3.max(dataset, d => d.year)+ 0.5])
                    // .domain([d3.min(dataset, d => d.year), d3.max(dataset, d => d.year)])
  
  const xScale = d3.scaleBand()
                    .domain(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"])
                    // .range([prodEnergyByMonthGroup.top(12)[11],prodEnergyByMonthGroup.top(12)[0]])
                    //[monthDim.bottom(1)[0].month, monthDim.top(1)[0].month]
  const ordinalScale = d3.scaleOrdinal()
                          // .domain(["2018","2019","2020"])
                       .domain(d3.extent(dataset, d => d.year))


  let FULLWIDTH = 1000;

    sunBurstChart.width(FULLWIDTH)
        .height(850)
        .innerRadius(90)
        .dimension(sunBurstDim)
        .group(sunBurstGroup)
        // .keyAccessor(function(d) {return +d.key[0];})
        // .valueAccessor(function(d) { return +d.value; })
        // .colorAccessor(function(d) { return +d.key[1]; })
        .colors(d3.scaleOrdinal(d3.schemeBlues[6]))
        .title(function(d) {
          return (
            "Unidade: " + d.key + "\n" +
            "Geração de energia: " + format(d.value) + " MWh"
          );
        })
        //.legend(dc.legend());

  
  
  // yearBarChart.xAxis().ticks(3)
  // yearBarChart.width(FULLWIDTH)
  //          .height(300)
  //          .margins({top: 10, right: 20, bottom: 20, left:60})
  //          .x(d3.scaleBand())
  //          .xUnits(dc.units.ordinal)
  //          .dimension(yearDim)
  //          .gap(100)
  //          .elasticY(true)
  //          .ordinalColors(['#7cb5ec'])
  //          .renderHorizontalGridLines(true)
  //           .barPadding(0.2)
  //           .outerPadding(0.2)
  //           .group(prodYearGroup)
  //           .brushOn(true)
           // .xAxisPadding(1)
           // .xAxis().tickFormat(d3.timeFormat("%B"))
  
  // depthBarChart.xAxis().ticks(12)
  monthBarChart.yAxis().ticks(10)
  // monthBarChart.xAxis().tickFormat(d3.timeFormat("%B"))
  monthBarChart.width(FULLWIDTH)
           .height(300)
           .margins({top: 10, right: 20, bottom: 20, left:60})
           .dimension(monthDim)
           .x(xScale)
           .group(prodEnergyByMonthGroup)
           .xUnits(dc.units.ordinal)
           .elasticY(true)
           .ordinalColors(['#7cb5ec'])
           .renderHorizontalGridLines(true)
           .gap(20)
  
  let compoChart = dc.compositeChart(view.querySelector("#composite-chart"));

  const compoScale = d3.scaleTime()
                   .domain([dateDim.bottom(1)[0].day, dateDim.top(1)[0].day])

  
  compoChart.width(FULLWIDTH)
              .height(350)
              .margins({top: 50, right: 50, bottom: 25, left: 40})
              .dimension(dateDim)
              .x(compoScale)
              .xUnits(d3.timeDays)
              .renderHorizontalGridLines(true)
              .legend(dc.legend().x(width-300).y(5).itemHeight(13).gap(5))   
              .compose([
                  dc.barChart(compoChart)
                    .group(prodEnergy, 'Generation')
                    .ordinalColors(['#7cb5ec']),
                  dc.lineChart(compoChart)
                    .group(prodEnergyExpected, 'Generation Goal')
                    .ordinalColors(['black'])]);

  // let customScaleBlues = d3.scaleOrdinal().domain([
  //   heatGroup.top(heatGroup.size())[heatGroup.size()-1].value, 
  //   heatGroup.top(1)[0].value]
  // ).range(d3.interpolateBlues)
  
  const customScaleBlues = d3.scaleSequential(d3.interpolateBlues).domain([
    heatGroup.top(heatGroup.size())[heatGroup.size()-1].value, 
    heatGroup.top(1)[0].value]
  );

  heatMapChart
          .width(FULLWIDTH)
          .height(300)
          .margins({ top: 10, right: 10, bottom: 20, left: 90 })
          .dimension(heatDim)
          .group(heatGroup)
          // .cols(months.reverse()).colOrdering(null)
          // .rows(sub_.reverse()).rowOrdering(null)
          .rowsLabel(d => sub_[d])
          .colsLabel(d => months[d])
          // .cols(months.reverse()).colOrdering(null)
          .keyAccessor(function(d) {return +d.key[0];})
          .valueAccessor(function(d) { return +d.key[1]; })
          .colorAccessor(function(d) { return +d.value; })
          .title(function(d) {
            return (
              "Mês: " + months_[d.key[0]] + "\n" +
              "Subparque: " + sub_[d.key[1]] + "\n" +
              "Geração de energia: " + format(d.value) + "W"
            );
          })
          //.colors(d3.schemeGreens[6])
          .colors(customScaleBlues)
          .calculateColorDomain();

let dataTable = dc.dataTable(view.querySelector("#dc-table-graph"));

        dataTable.width(FULLWIDTH)
          .height(700)
          .dimension(dateDim)
          .group(d => "")
          .size(4)
          .columns([
            'subpark',
            'wtg',
            'day',
            'generation'])
          .sortBy(d => d.generation)
          .order(d3.descending);
  
  dc.renderAll()

}
      </div>
    </div>


    <br>

  <div class='row'>
        <div id="mapid" class="col-6"></div>
        <div class="col-6">
          <div id='bulletGen'>
            <h5> </h5>
          </div>
          <div id='bulletDisp'>
            <h5> </h5>
          </div>
          <div id='bulletWind'>
            <h5> </h5>
          </div>
        </div>
    </div>

    <br><br><br><br>

    <div class="row">
      <h2>Topologia do Complexo</h2>
    </div>
    <div class="row">
      <h6>A seguir, estão dispostos os 4 subparques dessa usina, cada um com 14 turbinas, totalizando 56 aerogeradores e uma capacidade instalada de 112 MW.</h6>
    </div>

    <br>

    <div class='row'>
        <div id='pie-chart' class="single-col">
          <h5></h5>
        </div>
    </div>

    <br><br><br><br>

    <div class="row">
      <h2>Perfil Energético do Parque</h2>
    </div>
    <div class="row">
      <h6>A seguir vemos o perfil de geração do parque ao longo dos anos. É possível ver a característica de alta geração entre junho e setembro, devido à sazonalidade do recurso eólico.</h6>
    </div>

    <br>

    <div class='row'>
        <div id='heatmap-chart' class="single-col">
          <h5> Produção de energia em MWh por parque e mês do ano</h5>
        </div>
            
        <div id='month-chart' class="single-col">
          <h5> Produção de energia em MWh por mês </h5>
        </div>

        <div id='composite-chart' class="single-col">
          <h5> Geração de energia em MWh por dia </h5>
        </div>

      </div>

    <br><br><br><br>

    <div class="row">
      <h2>Dias com Maior Geração</h2>
    </div>

    <br>

        <table class="table table-hover" id="dc-table-graph">
            <thead>
                <tr class="header">
                    <th>Subparque</th>
                    <th>AEG</th>
                    <th>Dia</th>
                    <th>Geração</th>
                </tr>
            </thead>
        </table>

  </main>
